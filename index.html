<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Events!</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

  </head>

  <body>

    <nav class="navbar navbar-expand navbar-default bg-default nav_custom">
        <a class="navbar-brand" href="#">Hang Man: Historical</a>

        <div class="collapse navbar-collapse" id=navButtons>
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="#">Opt 1</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Opt 2</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Opt 3</a>
                </li>

            </ul>
        </div>
    </nav>

    <div class="container">
      <div class="row">
        <div class="col-md-offset-2 col-md-8">
          <div class="jumbotron">
            <h2 id="status">Guess A Letter <span id="rnd-word"></span></h2>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-offset-2 col-md-8">
          <div class="jumbotron">
            <h2 id="wrong-txt">Wrong Guess <span id="wrong-letter"></span></h2>
          </div>
        </div>
      </div>
    </div>

    <!-- script needs to be at the end of the document so that the elements
         have loaded by the time that we need them -->
    <script type="text/javascript">
      // Let's start by grabbing a reference to the <span> below.
      var userStats = {
        numWins: 0,
        totalPlays: 0,
        points: 0
      };

      var guessObj = {
        //currentGuess: "",
        randomWord: "",
        wordUnderline: "",
        arWords: ["BASIL"],
        arCorrectGuess: [],
        arWrongGuess: [],
        createRandomWord: function(){
          this.randomWord = this.arWords[Math.floor(Math.random()*this.arWords.length)];
        },
        getRandomWord: function(){
          return this.randomWord;
        },
        buildSpacesString: function(str){
          var spaces = "";
          for(var i = 0; i<str.length; i++){
            spaces += "_";
          }
          return spaces;
        },
        setWordUnderline: function(str){
          this.wordUnderline = this.buildSpacesString(str);
        },
        replaceSpaceWithCorrectGuess: function(char){
          for (var i = 0; i<this.randomWord.length; i++){
            if(this.randomWord.charAt(i) === char){
              //this.wordUnderline = char;  TODO function to splice in char for cur letter
              if(!this.arCorrectGuess.includes(char)){
                this.arCorrectGuess.push(char);
              }
              this.wordUnderline = this.wordUnderline.substr(0, i)+ char +this.wordUnderline.substr(i + char.length);
            }
          }
          return this.wordUnderline;
        }, 
        collectWrongGuess: function(char){
          if(this.randomWord !== "undefined" && !this.randomWord.includes(char)){
            this.arWrongGuess.push(char)
          }
        },
        setupMatch: function(){
          this.resetHangManObj();
          this.createRandomWord();
          var randomWord = this.getRandomWord();
          this.setWordUnderline(this.randomWord);
          var underline = this.buildSpacesString(randomWord)
          return underline;
        },
        resetHangManObj: function(){
          this.randomWord = "";
          this.wordUnderline = "";
          this.arCorrectGuess = [];
          this.arWrongGuess = [];
        }
      }
      var randEl = document.getElementById("rnd-word");
      var wrongText = document.getElementById("wrong-txt");
      var wrongEl = document.getElementById("wrong-letter");      

      document.body.onload = function(){
        //alert("load");
        // guessObj.createRandomWord();
        // var randomWord = guessObj.getRandomWord();
        // guessObj.setWordUnderline(guessObj.randomWord);
        var randomWord = guessObj.setupMatch();
        randEl.textContent = guessObj.buildSpacesString(randomWord);
      };

      var resetGame = function(message){
        var status = document.getElementById("status");
        status.childNodes[0].textContent = message;
        randEl.textContent = guessObj.randomWord;
        document.onkeyup =  null;
        setTimeout(function () {
          document.onkeyup = onKeyUpListener;
          var underlines = guessObj.setupMatch();
          status.childNodes[0].textContent = "Guess A Letter ";
          randEl.textContent = underlines;
          wrongText.childNodes[0].textContent = "Wrong Guess ";
          wrongEl.textContent = "";
        }, 5000);
      }

      var onKeyUpListener = function(event) {
        var char = event.key;
        while(!char.match(/[A-Za-z]/gi)){
          char = prompt("You must enter a letter");
        }
        char = char.charAt(0).toUpperCase();
        randEl.textContent = guessObj.replaceSpaceWithCorrectGuess(char);
        if(!guessObj.wordUnderline.includes("_")){
          resetGame("Correct: ")
        }
        if(guessObj.arWrongGuess.includes(char) || guessObj.arCorrectGuess.includes(char)){
          return;
        }
        guessObj.collectWrongGuess(char);
        wrongEl.textContent = guessObj.arWrongGuess.toString();
        if(guessObj.arWrongGuess.length > 8){
          resetGame("The word was: ");
        }else{
          wrongEl.textContent = guessObj.arWrongGuess.toString();
        }
      };

      document.onkeyup = onKeyUpListener;
      
      
    </script>
  </body>
</html>
